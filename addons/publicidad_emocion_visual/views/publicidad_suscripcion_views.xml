<odoo>
    <!-- LIST VIEW -->
    <record id="view_publicidad_suscripcion_list" model="ir.ui.view">
        <field name="name">publicidad.suscripcion.list</field>
        <field name="model">publicidad.suscripcion</field>
        <field name="arch" type="xml">
            <list string="Suscripciones de publicidad"
                  decoration-muted="state == 'cancel'"
                  decoration-info="state == 'draft'"
                  decoration-success="state == 'active'"
                  decoration-danger="state == 'expired'">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="product_id"/>
                <field name="centro_comercial"/>
                <field name="fecha_inicio"/>
                <field name="fecha_fin"/>
                <field name="state" widget="badge" 
                       decoration-info="state == 'draft'"
                       decoration-success="state == 'active'"
                       decoration-danger="state == 'expired'"/>
                <field name="estado_arte" widget="badge"
                       decoration-warning="estado_arte == 'pending'"
                       decoration-success="estado_arte == 'approved'"/>
            </list>
        </field>
    </record>

    <!-- FORM VIEW -->
    <record id="view_publicidad_suscripcion_form" model="ir.ui.view">
        <field name="name">publicidad.suscripcion.form</field>
        <field name="model">publicidad.suscripcion</field>
        <field name="arch" type="xml">
            <form string="Suscripción de publicidad">
                <header>
                    <button name="action_request_approval" string="Solicitar Aprobación" type="object" class="btn-primary"
                            groups="publicidad_emocion_visual.group_publicidad_asesor"
                            invisible="state != 'draft'"/>
                    
                    <button name="action_confirm" string="Validar Pago y Confirmar" type="object" class="btn-primary"
                            groups="publicidad_emocion_visual.group_publicidad_finanzas,base.group_erp_manager"
                            invisible="state != 'waiting_payment'"/>
                    
                    <button name="action_active" string="Iniciar Exhibición" type="object" class="btn-primary"
                            groups="publicidad_emocion_visual.group_publicidad_operaciones,publicidad_emocion_visual.group_publicidad_finanzas,base.group_erp_manager"
                            invisible="state != 'confirmed'"/>
                    
                    <button name="action_approve_art" string="Aprobar Arte" type="object" class="btn-secondary"
                            groups="publicidad_emocion_visual.group_publicidad_operaciones,publicidad_emocion_visual.group_publicidad_finanzas,base.group_erp_manager"
                            invisible="estado_arte != 'pending'"/>
                            
                    <button name="action_pause" string="Pausar" type="object"
                            invisible="state != 'active'"/>
                    
                    <button name="action_cancel" string="Cancelar" type="object"
                            invisible="state in ('cancel', 'expired')"/>
                            
                    <button name="action_draft" string="Volver a Borrador" type="object"
                            groups="base.group_erp_manager"
                            invisible="state == 'draft'"/>

                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting_payment,confirmed,active,expired"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="partner_id"/>
                            <field name="user_id"/>
                            <!-- Reubicado por solicitud urgente: Activo Visible -->
                            <field name="product_id" context="{'display_default_code': False}"/>
                            <field name="contrato_marco_id" 
                                   context="{'default_partner_id': partner_id}"
                                   options="{'quick_create': True, 'create_edit': True}"/>
                        </group>
                        <group>
                            <field name="state" invisible="1"/>
                            <field name="is_finanzas_or_admin" invisible="1"/>
                            <field name="is_operaciones_or_higher" invisible="1"/>
                            <separator string="Vigencia"/>
                            <label for="fecha_inicio" string="Periodo"/>
                            <div class="o_row">
                                <field name="fecha_inicio" widget="daterange" options="{'related_end_date': 'fecha_fin'}"/>
                                <i class="fa fa-long-arrow-right mx-2" aria-label="Arrow icon" title="Arrow"/>
                                <field name="fecha_fin"/>
                            </div>
                            <field name="duracion_meses"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Configuración de Servicio">
                            <group>
                                <group string="Variables de Negocio (Editables)">
                                    <field name="tipo_contenido" widget="radio" options="{'horizontal': true}"/>
                                    <field name="centro_comercial"/>
                                    <field name="ubicacion_macro"/>
                                </group>
                            </group>
                        </page>

                        <page string="Condiciones Comerciales">
                            <group>
                                <group string="Vigencia" invisible="1">
                                    <field name="duracion_meses"/>
                                    <field name="fecha_inicio"/>
                                    <field name="fecha_fin"/>
                                </group>
                                <group string="Facturación">
                                    <field name="precio_mensual" readonly="state != 'draft' or not is_finanzas_or_admin"/>
                                    <field name="valor_total" readonly="1"/>
                                    <field name="currency_id" invisible="1"/>
                                </group>
                                <group string="Método de Pago">
                                    <field name="metodo_pago" readonly="state != 'draft'"/>
                                    <field name="numero_cuotas" invisible="metodo_pago != 'cuotas'" readonly="state != 'draft'"/>
                                    <field name="valor_cuota" invisible="metodo_pago != 'cuotas'" readonly="1"/>
                                    <field name="porcentaje_anticipo" widget="percentage" invisible="metodo_pago not in ['anticipo_saldo', 'cuotas']" readonly="state != 'draft'"/>
                                    <field name="monto_anticipo" invisible="metodo_pago not in ['anticipo_saldo', 'cuotas']" readonly="1"/>
                                    <field name="anticipo_recibido" invisible="monto_anticipo == 0"/>
                                </group>
                            </group>
                        </page>

                        <page string="Configuración Técnica">
                           <group>
                                <group string="Especificaciones Técnicas (Solo Lectura)">
                                    <field name="formato" readonly="1" force_save="1"/>
                                    <field name="tamano" readonly="1" force_save="1"/>
                                </group>
                                <group string="Administración (Admin Only)" groups="base.group_erp_manager">
                                    <field name="manual_surcharge_ubicacion"/>
                                    <field name="manual_surcharge_contenido"/>
                                </group>
                                <group string="Aprobación de Arte">
                                    <field name="estado_arte" readonly="not is_operaciones_or_higher"/>
                                </group>
                           </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- SEARCH VIEW -->
    <record id="view_publicidad_suscripcion_search" model="ir.ui.view">
        <field name="name">publicidad.suscripcion.search</field>
        <field name="model">publicidad.suscripcion</field>
        <field name="arch" type="xml">
            <search string="Buscar suscripciones">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="contrato_marco_id"/>
                <field name="product_id"/>
                <field name="centro_comercial"/>

                <filter name="state_draft" string="Borrador" domain="[('state', '=', 'draft')]"/>
                <filter name="state_active" string="En Exhibición" domain="[('state', '=', 'active')]"/>
                <filter name="state_paused" string="Pausada" domain="[('state', '=', 'paused')]"/>
                <filter name="my_subscriptions" string="Mis Suscripciones" domain="[('user_id', '=', uid)]"/>

                <group expand="0" string="Agrupar Por">
                    <filter string="Cliente" name="group_by_partner" context="{'group_by': 'partner_id'}"/>
                    <filter string="Centro Comercial" name="group_by_cc" context="{'group_by': 'centro_comercial'}"/>
                    <filter string="Estado" name="group_by_state" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ACTION -->
    <record id="action_publicidad_suscripcion" model="ir.actions.act_window">
        <field name="name">Suscripciones de Publicidad</field>
        <field name="res_model">publicidad.suscripcion</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_publicidad_suscripcion_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crea tu primera suscripción publicitaria
            </p>
        </field>
    </record>

    <!-- MENUS -->
    <menuitem id="menu_publicidad_root"
              name="Publicidad"
              web_icon="publicidad_emocion_visual,static/description/icon.png"
              sequence="50"/>

    <menuitem id="menu_publicidad_operaciones"
              name="Operaciones"
              parent="menu_publicidad_root"
              sequence="10"/>

    <menuitem id="menu_publicidad_sub"
              name="Suscripciones"
              parent="menu_publicidad_operaciones"
              action="action_publicidad_suscripcion"
              sequence="10"/>

</odoo>
